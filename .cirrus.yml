 env:
  ARTIFACTORY_URL: https://repox.jfrog.io/repox
#   ARTIFACTORY_PRIVATE_USERNAME: private-reader
#   ARTIFACTORY_PRIVATE_PASSWORD: ENCRYPTED[!921e2792ce1fc164aaea1146ab2478e7aefd8aaa87022ca745adccee4deaa470bb883ad3066738fceb37622f239296a7!]
#   ARTIFACTORY_DEPLOY_USERNAME: public-qa-deployer
#   ARTIFACTORY_DEPLOY_PASSWORD: ENCRYPTED[!ee8f6410a42b81c6c91c7b760e7be7796a7774b6e6e6acf3ff2ecf8c7c04c732865a0300673ea41155c0d19a989c0a5a!]
#   #Possible values for ARTIFACTORY_DEPLOY_REPO: sonarsource-private-qa, sonarsource-public-qa
#   ARTIFACTORY_DEPLOY_REPO: sonarsource-public-qa
#   ARTIFACTORY_API_KEY: ENCRYPTED[!f9526e763214dcd6f0cac5fbf712664bcf05395cc5c8f9f122ccf3a4c6d42c2bc809bff8a6d9904c935a47a05676682c!]
#   # burgr notification
#   BURGR_URL: ENCRYPTED[!c7e294da94762d7bac144abef6310c5db300c95979daed4454ca977776bfd5edeb557e1237e3aa8ed722336243af2d78!]
#   BURGR_USERNAME: ENCRYPTED[!b29ddc7610116de511e74bec9a93ad9b8a20ac217a0852e94a96d0066e6e822b95e7bc1fe152afb707f16b70605fddd3!]
#   BURGR_PASSWORD: ENCRYPTED[!83e130718e92b8c9de7c5226355f730e55fb46e45869149a9223e724bb99656878ef9684c5f8cfef434aa716e87f4cf2!]
#   GITHUB_TOKEN: ENCRYPTED[!f272985ea5b49b3cf9c414b98de6a8e9096be47bfcee52f33311ba3131a2af637c1b956f49585b7757dd84b7c030233a!]
#   # Use bash (instead of sh on linux or cmd.exe on windows)
#   CIRRUS_SHELL: bash
#   # Allows to run builds for the 50 last commits in a branch:
#   CIRRUS_CLONE_DEPTH: 50

build_task:
  container:
    image: maven:latest
  maven_cache:
    folder: ~/.m2/repository 
  build_script:
    - mvn clean install
  build_cache:
    folder: ~/build_artifacts
    fingerprint_script:
      - ls ~/build_artifacts
    populate_script:
      - cp */target/*.jar ~/build_artifacts

plugin_qa_task:
  depends_on:
    - build
  container:
    image: maven:latest
  maven_cache:
    folder: ~/.m2/repository
  submodules_script:
    - git submodule update --init
  build_cache:
    folder: ~/build_artifacts
    fingerprint_script:
      - ls ~/build_artifacts
    # populate_script:
    #   - cp */target/*.jar ~/build_artifacts
  get_build_artifacts_script:
    - mkdir -p external-reports/target; cp ~/build_artifacts/external-reports-*.jar external-reports/target
    - mkdir -p java-checks/target; cp ~/build_artifacts/java-checks-*.jar java-checks/target
    - mkdir -p java-frontend/target; cp ~/build_artifacts/java-frontend-*.jar java-frontend/target
    - mkdir -p java-jsp/target; cp ~/build_artifacts/java-jsp-*.jar java-jsp/target
    - mkdir -p java-surefire/target; cp ~/build_artifacts/java-surefire-*.jar java-surefire/target
    - mkdir -p jdt/target; cp ~/build_artifacts/jdt-*.jar jdt/target
    - mkdir -p sonar-java-plugin/target; cp ~/build_artifacts/sonar-java-plugin-*.jar sonar-java-plugin/target
  qa_script:
    - echo "Ready to Run Integration Tests..."
